{"version":3,"sources":["../js/single-film.js"],"names":["searchParams","URLSearchParams","location","search","filmId","get","likes","document","getElementById","stars","querySelectorAll","fetchKinopoiskFilmData","filmDetailsRequest","answer","json","filmData","data","header","description","posterImage","premiere","textContent","nameRu","src","posterUrl","premiereRu","fethcFilmMeta","fetch","body","views","ratingNumber","rating","ratings","reduce","a","b","parseInt","length","intRating","Math","round","isNaN","floor","i","star","classList","add","likeIcon","FILM_KEY","liked","localStorage","getItem","addEventListener","contains","setItem","likesCount","innerHTML","method","headers","$","on","JSON","stringify","dataset","value"],"mappings":"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","sourcesContent":["const searchParams = new URLSearchParams(location.search);\r\nconst filmId = searchParams.get('id');\r\n\r\nconst likes = document.getElementById('sf-likes');\r\nconst stars = document.querySelectorAll('.rt-star');\r\n\r\n\r\nconst fetchKinopoiskFilmData = async () => {\r\n    const answer = await filmDetailsRequest(filmId);\r\n    const {\r\n        data: filmData\r\n    } = await answer.json();\r\n\r\n    const header = document.getElementById('sf-header');\r\n    const description = document.getElementById('sf-desc');\r\n    const posterImage = document.getElementById('sf-poster');\r\n    const premiere = document.getElementById('sf-premiere');\r\n\r\n\r\n    header.textContent = filmData.nameRu;\r\n    description.textContent = filmData.description;\r\n    posterImage.src = filmData.posterUrl;\r\n    premiere.textContent = filmData.premiereRu;\r\n};\r\n\r\nconst fethcFilmMeta = async () => {\r\n    const answer = await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}`)\r\n    const {\r\n        body\r\n    } = await answer.json();\r\n\r\n    const views = document.getElementById('sf-views');\r\n    const ratingNumber = document.getElementById('sf-rating-number');\r\n\r\n    views.textContent = `${body.views} Views`;\r\n    likes.textContent = `${body.likes} Likes`;\r\n\r\n    const rating = body.ratings.reduce((a, b) => parseInt(a) + parseInt(b), 0) / body.ratings.length;\r\n    const intRating = Math.round(rating);\r\n    if (isNaN(intRating)) {\r\n        ratingNumber.textContent = \"0.0\"\r\n    } else {\r\n        ratingNumber.textContent = Math.floor(rating * 10) / 10;\r\n    }\r\n\r\n    for (let i = 0; i < stars.length; i++) {\r\n        if (i >= intRating) break;\r\n        const star = stars[i];\r\n        star.classList.add('star-selected')\r\n    }\r\n}\r\n\r\nconst likeIcon = document.getElementById(\"like-icon\");\r\nconst FILM_KEY = `film-${filmId}`;\r\nconst liked = localStorage.getItem(FILM_KEY);\r\nif (liked !== null) {\r\n    likeIcon.classList.add('like-icon__liked');\r\n}\r\nlikeIcon.addEventListener(\"click\", () => {\r\n    if (!likeIcon.classList.contains('like-icon__liked')) {\r\n        localStorage.setItem(FILM_KEY, true)\r\n        const likesCount = parseInt(likes.textContent, 10) + 1;\r\n        likes.innerHTML = `${likesCount} Likes`;\r\n        likeIcon.classList.add('like-icon__liked');\r\n\r\n        fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/like`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n        })\r\n    }\r\n})\r\n\r\n\r\n$('.rating_stars').on('click', '.rt-star', async function () {\r\n\r\n    await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/rating`, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            rating: +this.dataset.value\r\n        })\r\n    });\r\n    fethcFilmMeta();\r\n})\r\n\r\n\r\nfetchKinopoiskFilmData();\r\nfethcFilmMeta();"],"file":"single-film.js"}