{"version":3,"sources":["../js/main_single-film.js"],"names":["searchParams","URLSearchParams","location","search","filmId","get","likes","document","getElementById","stars","querySelectorAll","fetchKinopoiskFilmData","answer","json","filmData","data","header","description","posterImage","premiere","textContent","nameRu","src","posterUrl","premiereRu","fethcFilmMeta","fetch","body","views","ratingNumber","rating","ratings","reduce","a","b","parseInt","length","intRating","Math","round","isNaN","toFixed","forEach","star","i","classList","add","likeIcon","FILM_KEY","liked","localStorage","getItem","addEventListener","contains","setItem","likesCount","innerHTML","method","headers","$","on","JSON","stringify","dataset","value"],"mappings":"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","sourcesContent":["import 'https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js';\r\nimport '../libs/own/owl.carousel.min.js';\r\nimport '../node_modules/@babel/polyfill/dist/polyfill.min.js';\r\nimport '../libs/fancybox/jquery.fancybox.min.js';\r\n\r\nimport \"./single.js\";\r\nimport \"./city.js\";\r\nimport { topFilmsRequest, filmDetailsRequest } from './__data__/api/kinopoiskapiunofficialRequest.js';\r\n\r\nconst searchParams = new URLSearchParams(location.search);\r\nconst filmId = searchParams.get('id');\r\n\r\nconst likes = document.getElementById('sf-likes');\r\nconst stars = document.querySelectorAll('.rt-star');\r\n\r\nconst fetchKinopoiskFilmData = async () => {\r\n    const answer = await filmDetailsRequest(filmId);\r\n    const {\r\n        data: filmData\r\n    } = await answer.json(); \r\n\r\n    const header = document.getElementById('sf-header');\r\n    const description = document.getElementById('sf-desc');\r\n    const posterImage = document.getElementById('sf-poster');\r\n    const premiere = document.getElementById('sf-premiere');\r\n\r\n    header.textContent = filmData.nameRu;\r\n    description.textContent = filmData.description;\r\n    posterImage.src = filmData.posterUrl;\r\n    premiere.textContent = filmData.premiereRu;\r\n};\r\n\r\nconst fethcFilmMeta = async () => {\r\n    const answer = await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}`)\r\n    const {\r\n        body\r\n    } = await answer.json();\r\n\r\n    const views = document.getElementById('sf-views');\r\n    const ratingNumber = document.getElementById('sf-rating-number');\r\n\r\n    views.textContent = `${body.views} Views`;\r\n    likes.textContent = `${body.likes} Likes`;\r\n\r\n    const rating = body.ratings.reduce((a, b) => parseInt(a) + parseInt(b), 0) / body.ratings.length;\r\n    const intRating = Math.round(rating);\r\n\r\n    if (isNaN(intRating)) {\r\n        ratingNumber.textContent = \"0.0\"\r\n    } else {\r\n        ratingNumber.textContent = rating.toFixed(1);\r\n    }\r\n\r\n    stars.forEach((star, i) => {\r\n        if (i < intRating) {\r\n            star.classList.add('star-selected')\r\n        };\r\n    })\r\n}\r\n\r\nconst likeIcon = document.getElementById(\"like-icon\");\r\nconst FILM_KEY = `film-${filmId}`;\r\nconst liked = localStorage.getItem(FILM_KEY);\r\nif (liked !== null) {\r\n    likeIcon.classList.add('like-icon__liked');\r\n}\r\nlikeIcon.addEventListener(\"click\", () => {\r\n    if (!likeIcon.classList.contains('like-icon__liked')) {\r\n        localStorage.setItem(FILM_KEY, true)\r\n        const likesCount = parseInt(likes.textContent, 10) + 1;\r\n        likes.innerHTML = `${likesCount} Likes`;\r\n        likeIcon.classList.add('like-icon__liked');\r\n\r\n        fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/like`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n        })\r\n    }\r\n})\r\n\r\n$('.rating_stars').on('click', '.rt-star', async function () {\r\n    await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/rating`, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            rating: +this.dataset.value\r\n        })\r\n    });\r\n    fethcFilmMeta();\r\n})\r\n\r\nfetchKinopoiskFilmData();\r\nfethcFilmMeta();"],"file":"main_single-film.js"}