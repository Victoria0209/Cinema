{"version":3,"sources":["../js/city.js"],"names":["SYPEX_URL","GLAVPUNKT_URL","selectedCity","cities","getRequest","url","callback","xhr","XMLHttpRequest","open","send","onreadystatechange","status","readyState","call","responseText","statusText","setCity","res","$","parseJSON","city","name_ru","html","setCities","getCityList","val","counter","i","length","name","toLowerCase","includes","document","ready","on","text","textContent","fancybox","close"],"mappings":";;AAAA,IAAMA,SAAS,GAAG,+BAAlB;AACA,IAAMC,aAAa,GAAG,wCAAtB;AACA,IAAIC,YAAJ,EAAkBC,MAAlB;;AAEA,SAASC,UAAT,CAAoBC,GAApB,EAAyBC,QAAzB,EAAmC;AAC/B,MAAMC,GAAG,GAAG,IAAIC,cAAJ,EAAZ,CAD+B,CAG/B;;AACAD,EAAAA,GAAG,CAACE,IAAJ,CAAS,KAAT,EAAgBJ,GAAhB,EAJ+B,CAM/B;;AACAE,EAAAA,GAAG,CAACG,IAAJ,GAP+B,CAS/B;;AACAH,EAAAA,GAAG,CAACI,kBAAJ,GAAyB,YAAY;AACjC;AACA,QAAIJ,GAAG,CAACK,MAAJ,IAAc,GAAd,IAAqBL,GAAG,CAACM,UAAJ,IAAkB,CAA3C,EAA8C;AAC1CP,MAAAA,QAAQ,CAACQ,IAAT,CAAcP,GAAG,CAACQ,YAAlB;AACH,KAFD,MAEO;AACH,aAAOR,GAAG,CAACS,UAAX;AACH;AACJ,GAPD;AAQH;;AAED,SAASC,OAAT,GAAmB;AACf;AACA,MAAIC,GAAG,GAAGC,CAAC,CAACC,SAAF,CAAY,IAAZ,CAAV;AACAlB,EAAAA,YAAY,GAAGgB,GAAG,CAACG,IAAJ,CAASC,OAAxB,CAHe,CAIf;;AAEAH,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBI,IAAhB,CAAqBrB,YAArB,EANe,CAOf;AACH;;AAED,SAASsB,SAAT,GAAqB;AACjBrB,EAAAA,MAAM,GAAGgB,CAAC,CAACC,SAAF,CAAY,IAAZ,CAAT;AACAK,EAAAA,WAAW;AACd;;AAED,SAASA,WAAT,GAAuB;AACnB;AACA,MAAIC,GAAG,GAAGP,CAAC,CAAC,aAAD,CAAD,CAAiBO,GAAjB,EAAV;AACA,MAAIC,OAAO,GAAG,CAAd;AACA,MAAIJ,IAAI,GAAG,MAAX,CAJmB,CAKnB;;AACA,OAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzB,MAAM,CAAC0B,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC;AACA,QAAIzB,MAAM,CAACyB,CAAD,CAAN,CAAUE,IAAV,CAAeC,WAAf,GAA6BC,QAA7B,CAAsCN,GAAG,CAACK,WAAJ,EAAtC,KAA4DJ,OAAO,GAAG,CAA1E,EAA6E;AACzEJ,MAAAA,IAAI,IAAI,SAASpB,MAAM,CAACyB,CAAD,CAAN,CAAUE,IAAnB,GAA0B,OAAlC;AACAH,MAAAA,OAAO;AACV;AACJ;;AAAA;AACDJ,EAAAA,IAAI,IAAI,OAAR;AACAJ,EAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBI,IAApB,CAAyBA,IAAzB;AACH;;AAEDJ,CAAC,CAACc,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAACf,CAAD,EAAO;AACrBf,EAAAA,UAAU,CAACJ,SAAD,EAAYiB,OAAZ,CAAV,CADqB,CAGrB;;AACAE,EAAAA,CAAC,CAACc,QAAD,CAAD,CAAYE,EAAZ,CAAe,OAAf,EAAwB,aAAxB,EAAuC,YAAY;AAC/C;AACA,QAAIhC,MAAJ,EACIsB,WAAW,GADf,KAEK;AACDrB,MAAAA,UAAU,CAACH,aAAD,EAAgBuB,SAAhB,CAAV;AACH;AACJ,GAPD;AAQAL,EAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoBgB,EAApB,CAAuB,OAAvB,EAAgC,IAAhC,EAAsC,YAAY;AAC9ChB,IAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBiB,IAAhB,CAAqB,KAAKC,WAA1B;AACAlB,IAAAA,CAAC,CAACmB,QAAF,CAAWC,KAAX;AACH,GAHD;AAKH,CAjBD","sourcesContent":["const SYPEX_URL = 'http://api.sypexgeo.net/json/';\r\nconst GLAVPUNKT_URL = 'https://glavpunkt.ru/api/get_rf_cities';\r\nlet selectedCity, cities;\r\n\r\nfunction getRequest(url, callback) {\r\n    const xhr = new XMLHttpRequest();\r\n\r\n    // настроили как открыть XMLHttpRequest\r\n    xhr.open('GET', url);\r\n\r\n    // выполнили отправку\r\n    xhr.send();\r\n\r\n    // отслеживает изменения статусов объекта XMLHttpRequest\r\n    xhr.onreadystatechange = function () {\r\n        // проверка успешно ли выполнился запрос\r\n        if (xhr.status == 200 && xhr.readyState == 4) {\r\n            callback.call(xhr.responseText);\r\n        } else {\r\n            return xhr.statusText;\r\n        }\r\n    }\r\n}\r\n\r\nfunction setCity() {\r\n    // получаем строку и превращаем ее в объект json\r\n    let res = $.parseJSON(this)\r\n    selectedCity = res.city.name_ru;\r\n    // вытащити русское название города\r\n\r\n    $('#city_link').html(selectedCity);\r\n    // прописываем в city_link название города\r\n}\r\n\r\nfunction setCities() {\r\n    cities = $.parseJSON(this);\r\n    getCityList()\r\n}\r\n\r\nfunction getCityList() {\r\n    // забираем значение из инпута;\r\n    let val = $('#city_input').val();\r\n    let counter = 0;\r\n    let html = '<ul>';\r\n    // Сравнение инпута с массивом и ограничение их до 5 шт\r\n    for (let i = 0; i < cities.length; i++) {\r\n        // приравниваем города к ниж регистру и сравниваем с буквами в инпуте (indexOf возвращает число -1 при несовпадении,и 0 при совпадении)\r\n        if (cities[i].name.toLowerCase().includes(val.toLowerCase()) && counter < 5) {\r\n            html += \"<li>\" + cities[i].name + '</li>';\r\n            counter++;\r\n        }\r\n    };\r\n    html += '</ul>';\r\n    $('#search_result').html(html);\r\n}\r\n\r\n$(document).ready(($) => {\r\n    getRequest(SYPEX_URL, setCity);\r\n\r\n    // вешаем событие keyup на инпут и запускаем проверку\r\n    $(document).on('keyup', '#city_input', function () {\r\n        // если список пустой,его нет,значит выполняем запрос к серверу и вызываем функцию с отрисовкой городов\r\n        if (cities)\r\n            getCityList()\r\n        else {\r\n            getRequest(GLAVPUNKT_URL, setCities)\r\n        }\r\n    })\r\n    $('#search_result').on('click', 'li', function () {\r\n        $('#city_link').text(this.textContent);\r\n        $.fancybox.close();\r\n    })\r\n\r\n})"],"file":"city.js"}